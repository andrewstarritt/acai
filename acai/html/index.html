<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>ACAI: Main Page</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.6.1 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li class="current"><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>ACAI Documentation</h1><h3><a class="el" href="namespaceACAI.html" title="All ACAI classes, typedefs, functons and enumerations are declared within the ACAI...">ACAI</a> 1.1.1 </h3><h2>Introduction</h2>
<p><a class="el" href="namespaceACAI.html" title="All ACAI classes, typedefs, functons and enumerations are declared within the ACAI...">ACAI</a> (ar-sigh-ee) is the <a class="el" href="namespaceACAI.html" title="All ACAI classes, typedefs, functons and enumerations are declared within the ACAI...">ACAI</a> Channel Access Interface - yes, it's one of those overused recursive acronyms.</p>
<p><a class="el" href="namespaceACAI.html" title="All ACAI classes, typedefs, functons and enumerations are declared within the ACAI...">ACAI</a> provides a not-so-thin C++ EPICS Channel Access abstraction around the basic Channel Access API. This has been developed on and for Linux, but should take minimal effort to modify the code for other environments.</p>
<p>The main <a class="el" href="classACAI_1_1Client.html" title="The ACAI::Client class is main class within the ACAI library.">ACAI::Client</a> class has been developed from the struct sCA_Client type and associated functions defined in pv_client.h/pv_client.c out of the kryten application.</p>
<p>The Acai (Euterpe oleracea) berry is known to originate from Amazon rainforest in Brazil.</p>
<h2>License</h2>
<p><a class="el" href="namespaceACAI.html" title="All ACAI classes, typedefs, functons and enumerations are declared within the ACAI...">ACAI</a> is distributed under the GNU General Public License version 3.</p>
<p>The <a class="el" href="namespaceACAI.html" title="All ACAI classes, typedefs, functons and enumerations are declared within the ACAI...">ACAI</a> library is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details.</p>
<h2>Using <a class="el" href="namespaceACAI.html" title="All ACAI classes, typedefs, functons and enumerations are declared within the ACAI...">ACAI</a> - Getting started</h2>
<p>First off, you will need to to include the following header files. Technically you get the first include via the second include, but I like to be explicit. </p>
<pre>
  #include &lt;<a class="el" href="acai__client__types_8h_source.html">acai_client_types.h</a>&gt;
  #include &lt;<a class="el" href="acai__client_8h_source.html">acai_client.h</a>&gt;
</pre><p>Next, choose the thread that will interface to <a class="el" href="namespaceACAI.html" title="All ACAI classes, typedefs, functons and enumerations are declared within the ACAI...">ACAI</a>. This can be the main program thread or any other thread. Within that thread call: </p>
<pre>
  <a class="el" href="classACAI_1_1Client.html#a83ff72cbfaacdbfe5d13493a6fc5b7e4">ACAI::Client::initialise()</a>;
</pre><p>This function's main purpose is to call <em>ca_context_create</em>. <a class="el" href="namespaceACAI.html" title="All ACAI classes, typedefs, functons and enumerations are declared within the ACAI...">ACAI</a> does not expose the under-lying EPICS context, nor does it provide a means for other threads to join/attach to that context. As the context is created with <em>ca_disable_preemptive_callback</em> additional, threads are not allowed to join the CA context (as per the 3.14 CAref manual).</p>
<p>NOTE: This version of <a class="el" href="namespaceACAI.html" title="All ACAI classes, typedefs, functons and enumerations are declared within the ACAI...">ACAI</a> does not support multiple contexts is any fashsion what-so-ever. The initialise, poll and finalise functions descrined herein are static functions.</p>
<p>Next create a client object, and open the channel </p>
<pre>
  <a class="el" href="classACAI_1_1Client.html" title="The ACAI::Client class is main class within the ACAI library.">ACAI::Client</a> pv ("SR11MCM01:CURRENT_MONITOR");
  pv.openChannel();
</pre><p>The openChannel function creates a channel and when the connection event (provided it is a successful) is processed requests a channel read (with all meta data) and subscribes for channel data updates.</p>
<p>Although <a class="el" href="namespaceACAI.html" title="All ACAI classes, typedefs, functons and enumerations are declared within the ACAI...">ACAI</a> uses EPICS callbacks internally, the callbacks are buffered and must be processed by calling <em><a class="el" href="classACAI_1_1Client.html#a97fa312020e773601d990059e5cfa38e">ACAI::Client::poll</a></em> from the nominated thread. When a buffered call back is processed, it updates the status/data/meta data of the associated client object, and then triggers the <a class="el" href="namespaceACAI.html" title="All ACAI classes, typedefs, functons and enumerations are declared within the ACAI...">ACAI</a> updates and callbacks. These all occur within the user's own thread. This avoids the need for any mutex locking when dealing with <a class="el" href="namespaceACAI.html" title="All ACAI classes, typedefs, functons and enumerations are declared within the ACAI...">ACAI</a> objects and/or data. If that data is passed on to any third party threads, then you will need to manage that.</p>
<p>All <a class="el" href="namespaceACAI.html" title="All ACAI classes, typedefs, functons and enumerations are declared within the ACAI...">ACAI</a> applications must have some sort of event loop. The event loop should must contain a small delay, very much application dependent, but typically 20mS to 50mS, e.g.: </p>
<pre>
  <b>while</b> (true) {
     epicsThreadSleep (0.02);  // 20mSec
     <a class="el" href="classACAI_1_1Client.html#a97fa312020e773601d990059e5cfa38e">ACAI::Client::poll</a> ();    // <a class="el" href="namespaceACAI.html" title="All ACAI classes, typedefs, functons and enumerations are declared within the ACAI...">ACAI</a> call back functions invoked from here
     ...
     ... any other application functionality
     ...
  }
</pre><p>If the application provides some means to break out of event loop then the following should be called to tidyup. This may be particularly important if leaving the event loop does not imply the application is to be terminated. </p>
<pre>
   pv.closeChannel();
   <a class="el" href="classACAI_1_1Client.html#a3789c6958794d51be718098c7651b4b9">ACAI::Client::finalise()</a>;
</pre><p>The above is fine, but we need to access the PV's data for this program to do anything useful. <a class="el" href="namespaceACAI.html" title="All ACAI classes, typedefs, functons and enumerations are declared within the ACAI...">ACAI</a> provides a number of ways to gain access to PV data. These are:</p>
<p>a) within the event loop, just read the data, if available, out of the client object; </p>
<pre>
     <b>if</b> (pv.dataIsAvailable()) {
        double x = pv.getFloating ();
        // do something with x
     }</pre><pre></pre><p>b) define and setup a connection and/or data update handler, e.g. </p>
<pre></pre><pre>  <b>static void</b> dataUpdateEventHandler (<a class="el" href="classACAI_1_1Client.html" title="The ACAI::Client class is main class within the ACAI library.">ACAI::Client</a>* client, <b>const</b> bool firstupdate)
  {
     double x = client-&gt;getFloating ();
     // do something with latest client data
  }</pre><pre>  ...</pre><pre>  pv.setUpdateHandler (dataUpdateEventHandler);</pre><pre></pre><p>c) derive a class based on <a class="el" href="classACAI_1_1Client.html" title="The ACAI::Client class is main class within the ACAI library.">ACAI::Client</a> and override the <a class="el" href="classACAI_1_1Client.html#a7dc6bbc676e5bfc0a83016bb701f8c73">ACAI::Client::connectionUpdate</a> or <a class="el" href="classACAI_1_1Client.html#ac0a65a75961cd27082f76aca5664938e">ACAI::Client::dataUpdate</a> functions;</p>
<pre>
  <b>class</b> MyClient : <b>public</b> <a class="el" href="classACAI_1_1Client.html" title="The ACAI::Client class is main class within the ACAI library.">ACAI::Client</a> {</pre><pre>     // override base class function
     <b>void</b> connectionUpdate (<b>const</b> bool isConnected) {
        double x = this-&gt;getFloating ();
        // do something with latest client data
     }
  }</pre><pre>  ...</pre><pre>  MyClient pv ("SR11MCM01:CURRENT_MONITOR");</pre><pre></pre><p>d) use an <a class="el" href="classACAI_1_1Abstract__Client__User.html" title="The ACAI::Abstract_Client_User is a base class provided to support application classes...">ACAI::Abstract_Client_User</a> class - refer to class documentation.</p>
<h4>Example</h4>
<p>An example program that brings all the above together has been included in acaiTestApp/acai_monitor.cpp The is a simple command line program that use the <a class="el" href="namespaceACAI.html" title="All ACAI classes, typedefs, functons and enumerations are declared within the ACAI...">ACAI</a> framework. This programs mimics the basic fuctionality of the EPICS base program camonitor.</p>
<p>Note: This program is intended as example (and test) <a class="el" href="namespaceACAI.html" title="All ACAI classes, typedefs, functons and enumerations are declared within the ACAI...">ACAI</a> program rather than as replacements for the afore mentioned camonitor program.</p>
<h2>Building/Linking</h2>
<p>An <a class="el" href="namespaceACAI.html" title="All ACAI classes, typedefs, functons and enumerations are declared within the ACAI...">ACAI</a> program, like the above example, may be built using the EPICS make system. However, as the <a class="el" href="namespaceACAI.html" title="All ACAI classes, typedefs, functons and enumerations are declared within the ACAI...">ACAI</a> header files only call up other <a class="el" href="namespaceACAI.html" title="All ACAI classes, typedefs, functons and enumerations are declared within the ACAI...">ACAI</a> header files the fallowing external header files: </p>
<pre>
  #include &lt;set&gt;
  #include &lt;string&gt;
  #include &lt;vector&gt;
</pre><p> it is easy to build an <a class="el" href="namespaceACAI.html" title="All ACAI classes, typedefs, functons and enumerations are declared within the ACAI...">ACAI</a> application without any reference to EPICS header files.</p>
<h2>Dependancies</h2>
<p>Apart from the EPICS shared libraries ca, Com and their dependancies, <a class="el" href="namespaceACAI.html" title="All ACAI classes, typedefs, functons and enumerations are declared within the ACAI...">ACAI</a> does not reply on any non-standard libraries and/or templates, thus there are no troublesome or unexpected dependancies. </p>
</div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&nbsp;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&nbsp;</span>Enumerator</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr size="1"/><address style="text-align: right;"><small>Generated on 21 Jul 2015 for ACAI by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
